name: Release

on:
  push: 
    tags: ['*']


jobs:

  draft-release:
    runs-on: ubuntu-20.04

    steps:
      - uses: actions/checkout@v3

      - name: Install dependencies
        run: |
          echo ${GITHUB_REF##*/}
          echo 'echo end'
          gh release create ${GITHUB_REF##*/} --title "${GITHUB_REF##*/}" --draft --generate-notes --prerelease --repo gurrpi/maci
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  publish:
      runs-on: ubuntu-20.04

      steps:
        - uses: actions/checkout@v3

        - name: Install dependencies
          run: |
            npx lerna publish from-git --dist-tag ${GITHUB_REF##*/} --yes
          env:
           NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
